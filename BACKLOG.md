# Backlog

紀錄待修復的 Bug 與待實作的功能需求。

---

## 實作順序

依優先級與依賴關係安排的建議實作順序：

### Phase 1：週策略組合（MVP 強化）✅
| 順序 | # | 描述 | 備註 |
|------|---|------|------|
| 1-1 | 12 | 週策略組合：資料模型與 API | ✅ 新增 `week_tactic_selections` 表 |
| 1-2 | 13 | 週策略組合：策略管理頁週切換器 + 勾選 | ✅ UI 變更 |
| 1-3 | 14 | 週策略組合：提前編輯下週組合 | ✅ 延伸 1-2 |
| 1-4 | 15 | 週策略組合：今日頁過濾 | ✅ 依據當週組合顯示 |

### Phase 2：策略組織優化 ✅
| 順序 | # | 描述 | 備註 |
|------|---|------|------|
| 2-1 | 8 | 策略管理：按領域分組顯示 | ✅ 利用現有 `category` 欄位 |
| 2-2 | 10 | 得分頁：策略排序同步 | ✅ 依賴 2-1 |
| 2-3 | 9 | 策略管理：拖放排序 | ✅ 新增 `sortOrder` 欄位 |

### Phase 3：個人功能擴充 ✅
| 順序 | # | 描述 | 備註 |
|------|---|------|------|
| 3-1 | 17 | 季度模型：Quarter 概念 | ✅ 新增 `quarters` 表 |
| 3-2 | 16 | 匯出分享：週/4週摘要 | ✅ URL hash 編碼，無需後端 |
| 3-3 | 11 | 得分頁：日期區間顯示 | ✅ 設定頁控制 |

### Phase 4：分組督責（多人協作）✅
| 順序 | # | 描述 | 備註 |
|------|---|------|------|
| 4-1 | 18 | 分組架構：Guild > Group > User | ✅ 後端 API 已完成 |
| 4-2 | 20 | 分組管理：管理者功能 | ✅ 前端 UI 已完成 |
| 4-3 | 19 | 分組督責：查看成員記錄 | ✅ 成員得分頁已完成 |

> **注意**：目前已移除 staleTime 設定以確保資料即時性。未來若需查看他人資料，可考慮加上手動刷新按鈕。

### Phase 5：個人體驗優化 ✅
| 順序 | # | 描述 | 備註 |
|------|---|------|------|
| 5-1 | 24 | 週視圖填寫模式 | ✅ 今日頁切換為週格子表格 |

### Phase 6：社交互動 ✅
| 順序 | # | 描述 | 備註 |
|------|---|------|------|
| 6-1 | 23 | 分享連結公開模式 | ✅ 後端儲存公開狀態 |
| 6-2 | 21 | 社交互動：表情回應 | ✅ 固定 6 個 emoji |
| 6-3 | 22 | 社交互動：留言 | ✅ 匿名化 + Badge + 已讀追蹤 |

---

## Bug

| # | 描述 | 發現日期 | 狀態 |
|---|------|----------|------|
| 1 | 每日任務的週執行率計算錯誤：應以 7 天為分母計算（如 2/7），目前顯示為 2/1 | 2026-01-08 | 已完成 |
| 2 | weekly_number 計算錯誤：應加總所有記錄，而非取最後一筆 | 2026-01-09 | 已完成 |
| 3 | records 表可能產生重複記錄（同 tacticId + date）| 2026-01-09 | 已完成 |
| 4 | 多週執行率計算錯誤：weekly_count/weekly_number 目標未依週數倍增 | 2026-01-09 | 已完成 |

---

## 功能需求

| # | 描述 | 提出日期 | 優先級 | 狀態 |
|---|------|----------|--------|------|
| 1 | 今日頁面：新增直接選擇特定日期的功能（日期選擇器） | 2026-01-08 | 中 | 已完成 |
| 2 | 得分頁面：新增格子/日曆視圖，顯示哪幾天有達成（離散呈現） | 2026-01-08 | 中 | 已完成 |
| 3 | 新增 `daily_time` 戰術類型：支援時間目標（如「01:00 前睡覺」） | 2026-01-08 | 高 | 已完成 |
| 4 | 新增 `targetDirection` 欄位：支援「至少」與「不超過」兩種目標方向 | 2026-01-08 | 高 | 已完成 |
| 5 | 點擊左上角 brand 導向今日頁面 | 2026-01-08 | 中 | 已完成 |
| 6 | 底部導覽「今日」按鈕：若在其他日期頁面，點擊後回到今日 | 2026-01-08 | 中 | 已完成 |
| 7 | 個人設定頁面：點擊右上角大頭貼開啟，可設定一週起始日（週日/週一） | 2026-01-08 | 中 | 已完成 |
| 8 | 策略管理：按領域分組顯示，相同領域的策略放在一起 | 2026-01-08 | 中 | 已完成 |
| 9 | 策略管理：支援拖放排序功能，可自訂領域順序與策略順序 | 2026-01-08 | 低 | 已完成 |
| 10 | 得分頁：策略排序與策略管理頁同步 | 2026-01-08 | 中 | 已完成 |
| 11 | 得分頁：在週執行率與各策略執行狀況之間顯示日期區間，是否顯示由設定頁控制 | 2026-01-08 | 低 | 已完成 |
| 12 | 週策略組合：每週可獨立設定計分的策略，新週預設沿用上週 | 2026-01-08 | 高 | 已完成 |
| 13 | 週策略組合：策略管理頁增加週切換器，可勾選該週計分的策略 | 2026-01-08 | 高 | 已完成 |
| 14 | 週策略組合：支援提前編輯下週組合 | 2026-01-08 | 高 | 已完成 |
| 15 | 週策略組合：今日頁只顯示該週計分的策略 | 2026-01-08 | 高 | 已完成 |
| 16 | 匯出分享：週/4週摘要頁面，用 URL hash 編碼資料，產生適合分享的頁面 | 2026-01-08 | 中 | 已完成 |
| 17 | 季度模型：新增 Quarter 概念，12 週為 1 季，支援季度目標設定與回顧 | 2026-01-08 | 中 | 已完成 |
| 18 | 分組督責：建立 Guild > Group > User 階層架構 | 2026-01-08 | 中 | 已完成 |
| 19 | 分組督責：User 可查看同 Group 或同 Guild 成員的執行記錄 | 2026-01-08 | 中 | 已完成 |
| 20 | 分組管理：管理者可建立/編輯 Guild 與 Group，管理成員 | 2026-01-08 | 中 | 已完成 |
| 21 | 社交互動：對其他成員的記錄留表情回應 | 2026-01-08 | 低 | 已完成 |
| 22 | 社交互動：公開分享留言功能（詳見下方規格） | 2026-01-08 | 低 | 已完成 |
| 23 | 分享連結公開模式：新增公開 toggle，公開時顯示「登入以留言」CTA，支援留言/表情；非公開時隱藏 CTA | 2026-01-09 | 中 | 已完成 |
| 24 | 週視圖填寫模式：今日頁可切換為週視圖（一週七天 × N 策略的格子表格），點擊格子 check 類型直接 toggle、其他類型彈出 modal 填寫，highlight 當天欄位，設定頁新增填寫模式選項 | 2026-01-10 | 中 | 已完成 |

---

## 功能規格：#22 公開分享留言功能

### 基本規格

| 面向 | 決定 |
|------|------|
| 留言對象 | 只有公開分享 |
| 留言層級 | 整個分享（不針對單一策略） |
| 回覆功能 | 單層留言（無巢狀） |
| 編輯/刪除 | 可以（自己的留言） |
| 顯示身份 | 登入者：顯示留言者名稱/頭像；未登入者：匿名化顯示 |

### 匿名化邏輯

- 未登入時，用 userId hash 對應到固定的匿名 ID
- 同一個分享頁內，同一人的留言會顯示同一個匿名 ID
- 使用簡單標籤如「訪客 A」「訪客 B」或動物名「🐻 熊」「🦊 狐狸」

### 得分頁 Badge

- 該週期有分享過 → 顯示 Badge 連結到分享頁
- Badge 顯示：表情數 + 留言數（0 不顯示數字）
- 有未讀留言 → 紅點或特殊樣式
- 已讀追蹤 → 使用 localStorage（簡單實作，不要求嚴謹一致性）

---

## 改善項目

| # | 描述 | 提出日期 | 狀態 |
|---|------|----------|------|
| 1 | 簡單 UI 操作使用樂觀更新（Optimistic Update）提升使用者體驗 | 2026-01-08 | 已完成 |
| 2 | 可點擊元素加上 `cursor: pointer`：今日頁左右切換/日期、登出按鈕、戰術頁新增/刪除、得分頁左右切換 | 2026-01-08 | 已完成 |
| 3 | 登出按鈕加上確認對話框（confirm） | 2026-01-08 | 已完成 |
| 4 | 登入頁按鈕加上 `cursor: pointer` 樣式 | 2026-01-08 | 已完成 |
| 5 | 頁面切換效能優化：預取相鄰日/週資料（日切換、週切換） | 2026-01-09 | 已完成 |
| 6 | weekly_number 得分頁顯示每日貢獻格子 | 2026-01-09 | 已完成 |
| 7 | 新增 records 表 unique index (tactic_id, date) 防止重複 | 2026-01-09 | 已完成 |

---

## 狀態說明

- `待處理` - 尚未開始
- `進行中` - 正在處理
- `已完成` - 已修復/實作
- `擱置` - 暫時不處理

## 優先級說明

- `高` - 影響核心功能，需盡快處理
- `中` - 重要但不緊急
- `低` - 可延後處理
